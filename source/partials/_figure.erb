<%
  pos = ""
  l = ""
  c = ""
  a = ""
  if locals["position"] or locals.has_key? :position
    pos = "--#{position}"
  end
  if locals["link"] or locals.has_key? :link
    text = link
    if locals["link_text"] or locals.has_key? :link_text
      text = link_text
    end
    l = " â€“ <a href=\"#{link}\" title=\"See the full photo\">#{text}</a>"
  end
  if locals["alt"] or locals.has_key? :alt
    a = alt
    c = alt
  end
  if locals["caption"] or locals.has_key? :caption
    c = caption
  end
%>
<figure class='figure figure<%= pos %> image--to-load'>
  <noscript>
    <img class='img--noscript' src='<%= image %>' alt='<%= a %>' title='<%= c %>'>
  </noscript>
  <img class='img--script'
    data-src='<%= image %>'
    src='<%= image.sub('_full', '_blur').sub('.gif', '.jpg') %>'
    data-js='lazy-load-image'
    alt='<%= a %>'
    title='<%= c %>' />
    <% if locals["caption"] or locals.has_key? :caption %>
      <figcaption class='figure__caption'><%= caption %><%= l %></figcaption>
    <% end %>
</figure>